<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link href="layui/css/layui.css" rel="stylesheet" />
    <link href="css/style.css?mv=20210527" rel="stylesheet" />
    <title>Document</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .lan {
            position: relative
        }
        
        .lanBt {
            font-weight: bold;
            font-size: 18px;
        }
        /* .lan-content {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            position: relative;
        } */
        
        .lan-h {
            font-weight: bold;
            font-size: 16px;
        }
        
        .lan-edit {
            position: absolute;
            width: 30px;
            height: 20px;
            top: 66px;
            right: 45px;
            padding-right: 20px;
            vertical-align: middle;
        }
        
        .edit-first {
            position: absolute;
            top: 107px;
            right: 45px;
        }
        
        .lan-edit a {
            color: #009fe3;
        }
        
        .Channels-configuration {
            font-family: OpenSans;
            font-size: 44px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.36;
            letter-spacing: normal;
            text-align: left;
            color: #343434;
            border-bottom: solid 1px #ddd;
            padding-bottom: 10px;
        }
        
        .Inputs {
            font-family: OpenSans;
            font-size: 28px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.36;
            letter-spacing: normal;
            text-align: left;
            color: #000000;
        }
        
        .Bilge-pump {
            font-family: OpenSans;
            font-size: 24px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.38;
            letter-spacing: normal;
            text-align: left;
            color: #000000;
            max-width: 88%;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .Channel {
            font-family: OpenSans;
            font-size: 20px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.35;
            letter-spacing: normal;
            text-align: left;
            color: #000000;
        }
        
        .Digital-input {
            opacity: 0.7;
            font-family: OpenSans;
            font-size: 16px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.38;
            letter-spacing: normal;
            text-align: left;
            color: #000000;
        }
        
        .Rectangle-1234 {
            /* width: 378px; */
            height: 128px;
            border-radius: 10px;
            border: solid 1px #707070;
            padding: 10px;
        }
        
        .Edit {
            font-family: OpenSans;
            font-size: 20px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.35;
            letter-spacing: normal;
            text-align: left;
            color: #009fe3;
            ;
            vertical-align: middle;
        }
        
        .col-sm-5 {
            border: 1px solid #000
        }
        
        .layui-layer-btn a.layui-layer-btn0 {
            color: #fff;
        }
        
        .disabled-status {
            font-family: OpenSans;
            font-size: 16px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: normal;
            letter-spacing: normal;
            text-align: left;
            color: #909090;
        }
        
        @media screen and (max-width: 1192px) {
            .Channels-configuration {
                font-size: 30px;
            }
        }
    </style>
</head>

<body>
    <div class="container-fluid" style="padding:30px 70px;">
        <h3 class="Channels-configuration">Channels configuration</h3>
        <input style="display: none" id="saved_id" name="saved_id" />
        <div class="row mt-40">
            <div class="col-sm-6 lan">
                <h4 class="lanBt Inputs">Inputs</h4>
                <div class="mt-20 Rectangle-1234 inputsEdit" dataId="1">
                    <p class="lan-h Bilge-pump" id="name1">--</p>
                    <p class="mt-10 Channel">Channel 1 </p>
                    <p class="mt-10 Digital-input" id="type1">--</p>
                    <span class="lan-edit Edit edit-first "><a href="#">Edit</a></span>
                </div>
            </div>
            <div class="col-sm-6 col-sm-offset-1 lan">
                <h4 class="lanBt Inputs">Outputs</h4>
                <div class="mt-20 Rectangle-1234 outputsEdit" dataId="5">
                    <p class="lan-h Bilge-pump" id="name5">--</p>
                    <p class="mt-10 Channel">Channel 5 </p>
                    <p class="mt-10 disabled-status" id="type5"></p>
                    <span class="lan-edit Edit edit-first "><a href="#">Edit</a></span>
                </div>
            </div>

            <div class="col-sm-6 col-sm-offset-1 lan mt-10">
                <div class="mt-20 Rectangle-1234 inputsEdit" dataId="2">
                    <p class="lan-h Bilge-pump" id="name2">--</p>
                    <p class="mt-10 Channel">Channel 2 </p>
                    <p class="mt-10 Digital-input" id="type2">--</p>
                    <span class="lan-edit Edit "><a href="#">Edit</a></span>
                </div>
            </div>
            <div class="col-sm-6 col-sm-offset-1 lan mt-10">
                <div class="mt-20 Rectangle-1234 outputsEdit" dataId="6">
                    <p class="lan-h Bilge-pump" id="name6">--</p>
                    <p class="mt-10 Channel">Channel 6 </p>
                    <p class="mt-10 disabled-status" id="type6"></p>
                    <span class="lan-edit Edit "><a href="#">Edit</a></span>
                </div>
            </div>
            <div class="col-sm-6 col-sm-offset-1 lan mt-10 ">
                <div class="mt-20 Rectangle-1234 inputsEdit" dataId="3">
                    <p class="lan-h Bilge-pump" id="name3">--</p>
                    <p class="mt-10 Channel">Channel 3 </p>
                    <p class="mt-10 Digital-input" id="type3">--</p>
                    <span class="lan-edit Edit "><a href="#">Edit</a></span>
                </div>
            </div>
            <div class="col-sm-6 col-sm-offset-1 lan mt-10">
                <div class="mt-20 Rectangle-1234 outputsEdit" dataId="7">
                    <p class="lan-h Bilge-pump" id="name7">--</p>
                    <p class="mt-10 Channel">Channel 7 </p>
                    <p class="mt-10 disabled-status" id="type7"></p>
                    <span class="lan-edit Edit "><a href="#">Edit</a></span>
                </div>
            </div>
            <div class="col-sm-6 col-sm-offset-1 lan mt-10 ">
                <div class="mt-20 Rectangle-1234 inputsEdit" dataId="4">
                    <p class="lan-h Bilge-pump" id="name4">--</p>
                    <p class="mt-10 Channel">Channel 4 </p>
                    <p class="mt-10 Digital-input" id="type4">--</p>
                    <span class="lan-edit Edit"><a href="#">Edit</a></span>
                </div>
            </div>
            <div class="col-sm-6 col-sm-offset-1 lan mt-10">
                <div class="mt-20 Rectangle-1234 outputsEdit" dataId="8">
                    <p class="lan-h Bilge-pump" id="name8">--</p>
                    <p class="mt-10 Channel">Channel 8 </p>
                    <p class="mt-10 disabled-status" id="type8"></p>
                    <span class="lan-edit Edit "><a href="#">Edit</a></span>
                </div>
            </div>
        </div>
    </div>
    <script src="layui/layui.js " charset="utf-8 "></script>
    <script type="text/javascript" src="js/common.js?mv=20210527"></script>
    <script>
        var frequency = 0;
        $(function() {
            layui.use('layer', function() {
                var layer = layui.layer;
                var loading = layer.load(0, {
                    shade: false
                });
                getMonitoringData(layer, loading);
            });
            //弹出一个iframe层
            $('.inputsEdit').on('click', function() {
                var name = $(this).children(".Bilge-pump").text();
                name = escape(name);
                var dataId = $(this).attr("dataId");
                var types = $(this).children(".Bilge-pump").attr("types");
                var alertID = $(this).children(".Bilge-pump").attr("alertID");
                var status = $(this).children(".Bilge-pump").attr("status");
                //iframe层
                parent.layer.open({
                    type: 2,
                    title: false,
                    closeBtn: 0,
                    //shadeClose: true,
                    shade: 0.8,
                    area: ['761px', '440px'],
                    content: ['editInput.html?ChannelID=' + dataId + '&name=' + name +
                        '&types=' + types + '&alertid=' + alertID + '&status=' + status,
                        'no'
                    ],
                    end: function() {
                        var ChannelID = $("#saved_id").val();
                        if (ChannelID) {
                            location.reload();
                        }

                    }
                });
            });

            $('.outputsEdit').on('click', function() {
                var name = $(this).children(".Bilge-pump").text();
                name = escape(name);
                var types = $(this).children(".Bilge-pump").attr("types");
                var dataId = $(this).attr("dataId");
                var alertID = $(this).children(".Bilge-pump").attr("alertID");
                var status = $(this).children(".Bilge-pump").attr("status");
                //iframe层
                parent.layer.open({
                    type: 2,
                    title: false,
                    closeBtn: 0,
                    //shadeClose: true,
                    shade: 0.8,
                    area: ['761px', '365px'],
                    content: ['editOutput.html?ChannelID=' + dataId + '&name=' + name +
                        '&types=' + types + '&alertid=' + alertID + '&status=' + status,
                        'no'
                    ],
                    end: function() {
                        var ChannelID = $("#saved_id").val();
                        console.log(ChannelID)
                        if (ChannelID) {
                            location.reload();
                        }

                    }
                });
            });
        })

        function getMonitoringData(layer, loading) {
            var data = {
                "jsonrpc": "2.0",
                "method": "IoConfigure",
                "params": {
                    "mode": "0",
                },
                "id": "9.1"
            }
            data = JSON.stringify(data);
            $.ajax({
                type: "post",
                url: "/action/action",
                data: data,
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function(res) {
                    layer.close(loading);
                    if (res.result && res.result.io_date) {
                        var json = res.result.io_date;
                        for (var i = 0; i < json.length; i++) {
                            $("#name" + (i + 1)).text(json[i].name);
                            $("#name" + (i + 1)).attr("types", json[i].types)
                            $("#name" + (i + 1)).attr("alertID", json[i].alter_id)
                            $("#name" + (i + 1)).attr("status", json[i].status);
                            if (i < 4) {
                                if (json[i].status == 1) {

                                    if (json[i].types == 0) {
                                        $("#type" + (i + 1)).text("Analog input");
                                    } else if (json[i].types == 2) {
                                        $("#type" + (i + 1)).text("Digital negative input");
                                    } else {
                                        $("#type" + (i + 1)).text("Digital postive input");
                                    }
                                } else {
                                    $("#type" + (i + 1)).text("DISABLED");
                                    $("#type" + (i + 1)).removeClass("Digital-input").addClass(
                                        "disabled-status")
                                }

                            } else {
                                if (json[i].status == 0) {
                                    $("#type" + (i + 1)).text("DISABLED");
                                } else {
                                    $("#type" + (i + 1)).text("");
                                }
                            }
                        }
                        layui.use(['form'], function() {
                            var form = layui.form;
                            form.render("checkbox");
                        });

                    } else if (res.error) {
                        layui.use(['form', 'layer'], function() {
                            var layer = layui.layer;
                            layer.msg("An error occurred：" + res.error.message);
                        })
                    }

                },
                error: function(jqXHR) {
                    console.log("Error message", JSON.stringify(jqXHR));
                    frequency++;
                    if (frequency < 3) {
                        setTimeout(() => {
                            getMonitoringData(layer, loading);
                        }, 5000);
                    } else {
                        frequency = 0;
                        layer.close(loading);
                        var tip =
                            '<div style="padding: 20px;text-align: center;word-wrap:break-word;">Abnormal communication!</div>';
                        promptMessage("Error message", tip);
                    }
                }
            })
        }



        $(".layui-layer").css("background", "none");
    </script>
</body>

</html>