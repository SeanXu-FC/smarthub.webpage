<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <link rel="stylesheet" href="css/bootstrap/3.3.7/bootstrap.min.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap/3.3.7/bootstrap.min.js"></script>
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/jquery.ipinput.css" rel="stylesheet" />
    <script src="js/lanConfiguration.js?mv=20210428"></script>
    <script src="js/jquery.ipinput.js"></script>
    <script src="layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/common.js?mv=20210428"></script>
    <title>Document</title>
    <style>
        .btn-primary.active {
            color: #fff;
            background-color: #03387f !important;
            border-color: #03387f !important;
        }
        
        .LAN-configuration {
            font-family: OpenSans;
            font-size: 44px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.36;
            letter-spacing: normal;
            text-align: left;
            color: #861f41
        }
        
        .btn1 {
            position: absolute;
            top: 22px;
            right: 80px;
        }
        
        .Path-101 {
            width: 138px;
            height: 52px;
            border: solid 1px #707070;
            background-color: #f1f1f1;
            border-radius: 5px;
        }
        
        .Path-101:hover {
            background-color: #861f41;
            color: #fff;
        }
        
        .Cancel {
            font-family: OpenSans;
            font-size: 22px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.45;
            letter-spacing: normal;
            text-align: center;
            color: #434343;
        }
        
        .Rectangle-1182:hover {
            background-color: #861f41;
            color: #fff;
        }
        
        .Rectangle-1182.active {
            background-color: #861f41;
        }
        
        .Rectangle-1182 {
            width: 138px;
            height: 52px;
            /* padding: 0 20px; */
            border-radius: 5px;
            background-color: #861f41;
            color: #fff;
        }
        
        .OK {
            font-family: OpenSans;
            font-size: 22px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.35;
            letter-spacing: normal;
            text-align: center;
            color: #ffffff;
            margin-left: 22px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group div p {
            padding-top: 7px;
        }
        
        .Automatically-DHCP-on {
            font-family: OpenSans;
            font-size: 18px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.44;
            letter-spacing: normal;
            text-align: left;
            color: #3a3a3a;
        }
        
        .form-control {
            padding: 3px 10px;
        }
        
        .Configure-IP {
            font-family: OpenSans;
            font-size: 18px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.33;
            letter-spacing: normal;
            text-align: left;
            color: #343434;
        }
        
        .For-correct-operation-with-Raymarine-MFDs-ensure-that-IP-configuration-is-set-to-automatic {
            opacity: 0.74;
            font-family: OpenSans;
            font-size: 14px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.43;
            letter-spacing: normal;
            text-align: left;
            color: #343434;
        }
        
        .form-horizontal .control-label {
            padding-top: 7px;
            margin-bottom: 0;
            text-align: left;
            color: #333;
        }
        
        .DHCP-server {
            font-family: OpenSans;
            font-size: 22px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.36;
            letter-spacing: normal;
            text-align: left;
            color: #333333;
        }
        
        .ipinput_div input[type="text"] {
            font-family: OpenSans;
            font-size: 18px;
            font-weight: normal;
            text-align: left;
            color: #343434;
        }
        
        .ip_input {
            width: 38px;
            height: 32px;
            line-height: 32px;
            /* color: #000000; */
            border: 0px;
            text-align: center;
            position: relative;
            top: -3px;
        }
        
        .all_input {
            position: relative;
            width: 202px;
            width: 40%;
            /* height: 20px; */
            /* font: normal 8px 宋体; */
            /* color: #000000; */
            /* border: 1px solid #000000; */
            text-align: center;
        }
        
        .w358 {
            width: 358px;
        }
        
        .width40 {
            width: 40% !important
        }
        
        .Rectangle-1282 {
            height: 34px;
            border-radius: 5px;
            border: solid 1px #707070;
        }
        
        .Rectangle-1269 {
            width: 204px;
            height: 41px;
            box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.16);
            border: solid 2px #26b167;
            background-color: #f9fffc;
            background: url("images/correct.png") no-repeat 5px 4px
        }
        
        .error-icon {
            width: auto;
            height: 41px;
            box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.16);
            border: solid 2px #b12626;
            background-color: #f9fffc;
            background: url("images/icon-info.png") no-repeat 5px 4px
        }
        
        .Password-successfully-changed {
            font-family: OpenSans;
            font-size: 18px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.44;
            letter-spacing: normal;
            text-align: left;
            color: #343434;
            padding: 5px 10px 5px 40px;
        }
        
        .Changes-saved {
            font-family: OpenSans;
            font-size: 18px;
            font-weight: 600;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.44;
            letter-spacing: normal;
            text-align: left;
            color: #343434;
        }
        
        #success {
            display: none;
            position: fixed;
            top: 20%;
            right: 500px;
            z-index: 999;
            background-color: #fff;
        }
        
        #error {
            display: none;
            position: fixed;
            top: 50px;
            right: 500px;
            z-index: 999;
            background-color: #fff;
        }
        
        .time-unit {
            font-family: OpenSans;
            font-size: 18px;
            font-weight: normal;
            text-align: left;
            color: #343434;
        }
    </style>
</head>

<body>
    <div class="container-fluid" style="margin:30px 70px;">
        <div class="row">
            <div style="position:relative;margin-bottom:40px;border-bottom: solid 1px #ddd;padding-bottom: 10px;" class="LAN-configuration">WLAN configuration
            </div>
            <div id="success" class="Rectangle-1269 Password-successfully-changed Changes-saved">Changes-saved</div>
            <div id="error" class="error-icon Password-successfully-changed Changes-saved"></div>
            <div class="form-horizontal" name="formdata" id="content">
                <!-- <div class="form-group" id="ipMode">
                    <label for="" class="col-sm-4 control-label Configure-IP">Configure IP:
                        <div
                            class="For-correct-operation-with-Raymarine-MFDs-ensure-that-IP-configuration-is-set-to-automatic">
                            For correct operation with Raymarine MFDs ensure that IP configuration is set to automatic
                        </div>
                    </label>

                    <div class="col-sm-8 selectContent">
                        <select class="form-control width100 Automatically-DHCP-on" id="rsd" style="width:358px;border: solid 1px #707070;">
                            <option value="Automatically (DHCP on)">Automatically (DHCP on)</option>
                            <option value="Manually (DHCP on)">Manually (DHCP on)</option>
                            <option value="Manually (DHCP off)">Manually (DHCP off)</option>
                        </select>
                    </div>
                </div> -->
                <div id="main">

                    <div id="d2">
                        <div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label Configure-IP">IP address:</label>
                                <div class="col-sm-8">
                                    <input class="form-control Configure-IP" id="ip1" type="text" name="ip" />
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label Configure-IP">Subnet mask:</label>
                                <div class="col-sm-8">
                                    <input class="form-control Configure-IP" id="net_mask" type="text" name="ip" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label Configure-IP">Gateway:</label>
                                <div class="col-sm-8">
                                    <input class="form-control Configure-IP" id="Gate_way" type="text" name="ip" />
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <div class="col-sm-4">
                                    <h4 class="DHCP-server">DHCP server settings</h4>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label Configure-IP">Start IP address:</label>
                                <div class="col-sm-8">
                                    <input class="form-control Configure-IP" id="startip" type="text" name="ip" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-4 control-label Configure-IP">End IP address:</label>
                                <div class="col-sm-8">
                                    <input class="form-control Configure-IP" id="endip" type="text" name="ip" />
                                </div>
                            </div>
                            <div class="form-group form-inline">
                                <label for="" class="col-sm-4 control-label Configure-IP">DHCP lease time:</label>
                                <div class="col-sm-8">
                                    <input type="number" id="leasetime" class="form-control Rectangle-1282 Configure-IP" name="sec" placeholder="" style="border: solid 1px #707070;"><span class="time-unit" style="margin-left:10px;">seconds</span>
                                </div>
                            </div>
                            <div class="btn1" id="btn02">
                                <span class="qx" style="display: inline-block;margin-left:148px;"><button id="cancel"
                                        class="Path-101 Cancel">Cancel</button></span>
                                <span class="connected" style="display: inline-block;"><button id="btn2"
                                        class="Rectangle-1182 active OK">Save</button></span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        // $("#btn3").on("click", function() {
        //     $('#success').show(1000);
        //     setTimeout(function() {
        //         $('#success').hide();
        //     }, 6000);
        //     $("#btn3").removeAttr("disabled");
        //     $("#btn3").css("opacity", "1");
        //     $("#cancel").removeAttr("disabled");
        //     $("#cancel").css("opacity", "1");

        //     return false;
        // });
        $("#cancel").on("click", function() {

            eco_refresh('my-iframe')
        });
    </script>
    <script>
        var frequency = 0;
        $(function() {

            layui.use('layer', function() {
                var layer = layui.layer;
                var loading = layer.load(0, {
                    shade: false
                });
                getWlanData(layer, loading);
            });

            $("#btn2").on("click", function() {
                var leasetime = Number($('#leasetime').val());
                var data = {
                    "jsonrpc": "2.0",
                    "method": "SetLanSettings",
                    "params": {
                        "IPv4IPAddress": $('#ip1_ipinput input[name="ipOne"]').val() + '.' + $(
                            '#ip1_ipinput input[name="ipTwo"]').val() + '.' + $(
                            '#ip1_ipinput input[name="ipThree"]').val() + '.' + $(
                            '#ip1_ipinput input[name="ipFour"]').val(),
                        "SubnetMask": $('#net_mask_ipinput input[name="ipOne"]').val() + '.' + $(
                            '#net_mask_ipinput input[name="ipTwo"]').val() + '.' + $(
                            '#net_mask_ipinput input[name="ipThree"]').val() + '.' + $(
                            '#net_mask_ipinput input[name="ipFour"]').val(),
                        "LanGateWay": $('#Gate_way_ipinput input[name="ipOne"]').val() + '.' + $(
                            '#Gate_way_ipinput input[name="ipTwo"]').val() + '.' + $(
                            '#Gate_way_ipinput input[name="ipThree"]').val() + '.' + $(
                            '#Gate_way_ipinput input[name="ipFour"]').val(),
                        "StartIPAddress": $('#startip_ipinput input[name="ipOne"]').val() + '.' + $(
                            '#startip_ipinput input[name="ipTwo"]').val() + '.' + $(
                            '#startip_ipinput input[name="ipThree"]').val() + '.' + $(
                            '#startip_ipinput input[name="ipFour"]').val(),
                        "EndIPAddress": $('#endip_ipinput input[name="ipOne"]').val() + '.' + $(
                            '#endip_ipinput input[name="ipTwo"]').val() + '.' + $(
                            '#endip_ipinput input[name="ipThree"]').val() + '.' + $(
                            '#endip_ipinput input[name="ipFour"]').val(),
                        "DHCPLeaseTime": Number(leasetime)
                    },
                    "id": "9.1"
                }

                data = JSON.stringify(data);
                console.log(data);
                $.ajax({
                    type: "post",
                    url: "/action/action",
                    data: data,
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: function(res) {
                        if (res.result) {
                            // layui.use('layer', function () {
                            //     var layer = layui.layer;
                            //     layer.msg('不开心。。', {icon: 1});
                            // });
                            $('#success').show(1000).delay(6000).hide(0);
                            $("#btn2").removeAttr("disabled");
                            $("#btn2").css("opacity", "1");
                            $("#cancel").removeAttr("disabled");
                            $("#cancel").css("opacity", "1");
                        } else if (res.error) {
                            $("#error").text(res.error.message)
                            $("#error").show(1000).delay(6000).hide(0);
                            $("#btn2").removeAttr("disabled");
                            $("#btn2").css("opacity", "1");
                            $("#cancel").removeAttr("disabled");
                            $("#cancel").css("opacity", "1");
                        }

                    },
                    error: function(jqXHR) {
                        console.log("Error message", JSON.stringify(jqXHR))
                        parent.layer.close(loading);
                        var tip =
                            '<div style="padding: 20px;text-align: center;word-wrap:break-word;">Abnormal communication, please try again later!</div>';
                        promptMessage("Error message", tip);
                    }
                });
            })

        });

        function timeConversion(millisec) {
            var seconds = (millisec * 3600).toFixed(0);
            //return seconds + " seconds";
            return seconds;
        }

        function getWlanData(layer, loading) {
            var data = {
                "jsonrpc": "2.0",
                "method": "GetLanSettings",
                "params": {},
                "id": "9.1"
            }

            data = JSON.stringify(data);
            $.ajax({
                type: "post",
                url: "/action/action",
                data: data,
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function(res) {
                    layer.close(loading);
                    if (res.result) {
                        var json = res.result;
                        var str = "";
                        $('#d2').show();
                        $('#ip1').ipinput({
                            value: json.IPv4IPAddress
                        });
                        $('#net_mask').ipinput({
                            value: json.SubnetMask
                        });
                        $('#Gate_way').ipinput({
                            value: json.LanGateWay
                        });
                        $('#startip').ipinput({
                            value: json.StartIPAddress
                        });
                        $('#endip').ipinput({
                            value: json.EndIPAddress
                        });
                        var lease = $('input[name="sec"]').eq(0).val(json
                            .DHCPLeaseTime);
                    } else {
                        var tip =
                            '<div class="custom-waring"><img src="../images/waring.png"><span class="waring-text">' +
                            res.error.message + '</span></div>'
                        tipMessage(tip);
                    }
                },
                error: function(jqXHR) {
                    console.log("Error message", JSON.stringify(jqXHR));
                    frequency++;
                    if (frequency < 3) {
                        setTimeout(() => {
                            getWlanData(layer, loading);
                        }, 5000);
                    } else {
                        frequency = 0;
                        layer.close(loading);
                        var tip =
                            '<div style="padding: 20px;text-align: center;word-wrap:break-word;">Abnormal communication!</div>';
                        promptMessage("Error message", tip);
                    }
                }
            });
        }
    </script>

</body>

</html>